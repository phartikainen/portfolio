/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.2 - 2014-04-02
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 *//*global angular *//*
Angular touch carousel with CSS GPU accel and slide buffering
http://github.com/revolunet/angular-carousel

*/angular.module("angular-carousel",["ngTouch"]);angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(e,t,n){e.prev=function(){e.index--};e.next=function(){e.index++}},template:'<div class="rn-carousel-controls"><span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span><span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span></div>'}}]);angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span></div>'}}]);(function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(e,t,n,r,i,s){var o=0,u=75,a=.05,f=3,l=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(c,h){var p=c.children()[0].attributes,d=!1,v=!1,m=0,g=!1,y,b;c.addClass("rn-carousel-slides");c.children().addClass("rn-carousel-slide");["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(e){var t=p[e];if(angular.isDefined(t)){var n=t.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),r=n[3];y=n[1];b=n[2];if(y){if(angular.isDefined(h.rnCarouselBuffered)){v=!0;t.value=y+" in "+b+"|carouselSlice:carouselBufferIndex:carouselBufferSize";r&&(t.value+=" track by "+r)}d=!0;return!1}}return!0});return function(c,h,p,m){function H(){var e=[];for(var t=0;t<C;t++)e[t]=t;c.carouselIndicatorArray=e}function B(){var e=A.children();e.length===0?y=A[0].getBoundingClientRect().width:y=e[0].getBoundingClientRect().width;return y}function j(){O.css("width","100%");var e=B();e&&O.css("width",e+"px")}function F(e){isNaN(e)&&(e=c.carouselIndex*y);T=e;var t=-Math.round(T);t+=c.carouselBufferIndex*y;Q?A[0].style[w]="translate3d("+t+"px, 0, 0)":A[0].style[w]="translate("+t+"px, 0)"}function I(){var e,t;if(x){e=Date.now()-L;t=x*Math.exp(-e/u);if(t>f||t<-f){F(N-t);l(I)}else U(N/y)}}function q(e){return e>=C?C:e<=0?0:e}function R(){var e=0,t=(c.carouselBufferSize-1)/2;v&&(c.carouselIndex<=t?e=0:C<c.carouselBufferSize?e=0:c.carouselIndex>C-c.carouselBufferSize?e=C-c.carouselBufferSize:e=c.carouselIndex-t);c.carouselBufferIndex=e}function U(e,t){isNaN(e)&&(e=c.carouselIndex);if(t){T=e*y;J(null,null,!0);return}c.carouselIndex=q(e);R();s.$$phase!=="$apply"&&s.$$phase!=="$digest"&&(g?c.$apply():c.$digest());F()}function z(){return a*y}function W(e){k=!0;J({x:e.clientX,y:e.clientY},e)}function X(e){var t=e;c.carouselIndex===0?t=Math.max(-z(),t):c.carouselIndex===C-1&&(t=Math.min((C-1)*y+z(),t));return t}function V(e,t){n.bind("mouseup",W);E=!0;S=e.x;x=0;L=Date.now();return!1}function $(e,t){var n,r;if(E){n=e.x;r=S-n;if(r>2||r<-2){k=!0;S=n;l(function(){F(X(T+r))})}}return!1}function J(e,t,r){if(t&&!k)return;n.unbind("mouseup",W);E=!1;k=!1;N=T;var i=z(),s=c.carouselIndex*y,o=s-N,u=-Math[o>=0?"ceil":"floor"](o/y),a=Math.abs(o)>i;u+c.carouselIndex>=C&&(u=C-1-c.carouselIndex);u+c.carouselIndex<0&&(u=-c.carouselIndex);var f=a?u:0;N=(f+c.carouselIndex)*y;x=N-T;L=Date.now();r&&(x=T-s);l(I);return!1}function K(){var e=document.createElement("p"),t,n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in n)if(e.style[r]!==undefined){e.style[r]="translate3d(1px,1px,1px)";t=window.getComputedStyle(e).getPropertyValue(n[r])}document.body.removeChild(e);return t!==undefined&&t.length>0&&t!=="none"}function G(){j();U()}o++;var y,w,E,S,x,T=0,N,C=0,k=!1,L,A=h.wrap("<div id='carousel-"+o+"' class='rn-carousel-container'></div>"),O=A.parent();if(angular.isDefined(p.rnCarouselIndicator)||angular.isDefined(p.rnCarouselControl)){H();c.$watch("carouselIndex",function(e){c.indicatorIndex=e});c.$watch("indicatorIndex",function(e){U(e,!0)})}if(angular.isDefined(p.rnCarouselIndicator)){var M=i("<div id='carousel-"+o+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(c);O.append(M)}if(angular.isDefined(p.rnCarouselControl)){var _=i("<div id='carousel-"+o+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(c);O.append(_)}c.carouselBufferIndex=0;c.carouselBufferSize=5;c.carouselIndex=0;if(p.rnCarouselIndex){var D=function(e){P.assign(c.$parent,e)},P=r(p.rnCarouselIndex);if(angular.isFunction(P.assign)){c.$watch("carouselIndex",function(e){D(e)});c.carouselIndex=P(c);c.$parent.$watch(P,function(e,t){if(e!==undefined){if(e>=C){e=C-1;D(e)}else if(e<0){e=0;D(e)}U(e,!0)}});g=!0}else isNaN(p.rnCarouselIndex)||(c.carouselIndex=parseInt(p.rnCarouselIndex,10))}if(d)c.$watchCollection(b,function(e,t){C=0;angular.isArray(e)?C=e.length:angular.isObject(e)&&(C=Object.keys(e).length);H();y||j();U(c.carouselIndex)});else{C=h.children().length;H();j()}p.$observe("rnCarouselSwipe",function(t,n){t!=="false"&&t!=="off"?e.bind(A,{start:V,move:$,end:J,cancel:function(e){J({},e)}}):A.unbind()});g||U(c.carouselIndex);w="transform";["webkit","Moz","O","ms"].every(function(e){var t=e+"Transform";if(typeof document.body.style[t]!="undefined"){w=t;return!1}return!0});var Q=K(),Y=angular.element(t);Y.bind("orientationchange",G);Y.bind("resize",G);c.$on("$destroy",function(){n.unbind("mouseup",W);Y.unbind("orientationchange",G);Y.unbind("resize",G)})}}}}])})();(function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(e,t,n){if(angular.isArray(e))return e.slice(t,t+n);if(angular.isObject(e))return e}})})();